\input{preamble}

% OK, start here.
%
\begin{document}

\title{The automorphic space}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{The automorphic quotient, and basic examples}
\label{section-automorphic-quotient}

Automorphic representations are the representations that appear when we perform harmonic analysis on the homogeneous space $G(k)\backslash G(\mathbb A)$, where $k$ is a global field and $\mathbb A$ is its ring of adeles. 


Let $G$ be a linear algebraic group over $k$. Since $G$ is affine, the subgroup $G(k)$ of $G(\mathbb A)$ is discrete and the space $[G]:=G(k)\backslash G(\mathbb A)$ is a locally compact space, homogeneous under the action of $G(\mathbb A)$. It carries an invariant measure under $G(\mathbb A)$.

\begin{definition}
 \label{definition-automorphic-space}
If $G$ is a linear algebraic group over $k$, the space $G(k)\backslash G(\mathbb A)$ is called the {\it automorphic space} of $G$, and denoted by $[G]$. 
\end{definition}
This term is not completely standard, but there is no other name for it. Here we study properties of this space, discuss the adelic and the classical picture, and some relevant arithmetic issues. We fix throughout a global field $k$ (either a number field, or the function field of a curve over a finite field), and all groups are linear algebraic groups defined over $k$. The letters $S, \Sigma$ will always denote finite sets of places of $k$, $\mathbb A^S$ will denote the adeles outside of $S$, i.e. the restricted product $\prod'_{v\notin S} k_v$, and $\mathbb A_S$ will denote the product $\prod_{v\in S} k_v$. For a variety $X$ over $S$ we will denote: $X_k:=X(k)$, $X_{\mathbb A}:=X(\mathbb A)$, $X^S:= X(\mathbb A^S)$ and $X_S:= X(\mathbb A_S)$. The (finite) set of archimedean places will be denoted by $\infty$. If $k$ is a function field, we pick a place that we denote by $\infty$. We let $\mathfrak o$ be the ring of integers of $k$, if $k$ is a number field, and the ring of integers away from the chosen place $\infty$, if $k$ is a function field. We let $\mathbb A_f = \mathbb A^\infty$, the ring of finite adeles, when $k$ is a number field, and the ring of adeles away from $\infty$, when $k$ is a function field. 



\subsection{The additive group}
\label{subsection-additive}

\begin{proposition}
\label{proposition-automorphic-Ga}
Let $G = \mathbb G_a$. The automorphic space $[G]$ is compact, and for any non-empty set $S$ of places of $k$, the embedding $k\hookrightarrow \mathbb A^S$ is dense. In particular, for 
every open compact $K\subset \mathbb A_f$, the group $k_\infty$ acts with a unique orbit on the quotient space $[G]/K$, which is isomorphic to $k_\infty / \mathfrak o_K$ as a $k_\infty$-space, for a subgroup $\mathfrak o_K$ of $k_\infty$ that is finitely generated over the integers of the base field (i.e., over $\mathbb Z$ or $\mathbb F_q[t]$).
\end{proposition}

\begin{proof}
 By restriction of scalars, $\text{Res}_{k/\mathbb Q} \mathbb G_a = \mathbb G_a^{(k:\mathbb Q)}$, the problem reduces to the base field $k=\mathbb Q$ or $k=\mathbb F_q(t)$. We present only the case of $k=\mathbb Q$, $S=\{\infty\}$, leaving the general case as an exercise to the reader. In this case, we have $\mathbb A^S = \mathbb A_f = \widehat{\mathbb Z} \otimes \mathbb Q$, and the density statement follows from the density of $\mathbb Z$ in its profinite completion. 
 
 The stabilizer for the action of $k_\infty$ on $[G]/K$ is the intersection $k\cap K k_\infty$. This is a submodule for $\mathbb Z$ or $\mathbb F_q[t]$, because every open compact subgroup $K$ is (exercise!). It is finitely generated, because this is the case when $K = N \cdot \prod_v \mathfrak o_v$ for some $N\in k^\times$, and any compact open $K$ is contained in such a subgroup.
 
 In the particular case $K = \prod_v \mathfrak o_v$, we obtain the quotient $k_\infty/\mathfrak o$, which is compact, hence $[G]$ is compact.
\end{proof}




\subsection{The multiplicative group}
\label{subsection-multiplicative}


\begin{proposition}
\label{proposition-automorphic-Gm}
 Let $G=\mathbb G_m$. The product of absolute values defines a homomorphism $[G]\to \mathbb R^\times_+$, whose kernel is compact. If $K\subset \mathbb A_f^\times$ is the maximal compact subgroup (the product of local units), then the $k_\infty^\times$-orbits on $[G]/K$ are canonically parametrized (under the natural homomorphism from ideles to fractional ideals, sending a uniformizer at a finite place to the corresponding ideal) by the class group of $k$, and each is isomorphic to $k_\infty^\times / \mathfrak o^\times$. The orbits of the identity component $(k_\infty^\times)^0$ are parametrized by the narrow class group of $k$.
 
 More generally, if $K = \prod_{v\notin S} \mathfrak o_v^\times \prod_{v\in S} (1+\mathfrak p_v^{r_v})$, where $S$ is a finite set of finite primes, the $k_\infty^\times$-orbits on $[G]/K$ are canonically parametrized by the ray class group of modulus $\mathfrak m = \prod_{v\in S} \mathfrak p_v^{r_v}$, and the $(k_\infty^\times)^0$-orbits by the corresponding narrow ray class group.
\end{proposition}

\begin{proof}
 For an idele $a = (a_v)_v$, let $\lambda(a)$ be the number of $\alpha\in k$ with $|\alpha|_v\le  |a_v|$ for all $v$. Then, there are constants $c_1, c_2$, depending only on $k$, such that 
 $$ c_1 \le \frac{\lambda(a)}{|a|} \le c_2$$
 for any $a$. Indeed, by restriction of scalars for $\mathbb G_a$, the problem reduces to the base field $\mathbb Q$ or $\mathbb F_q(t)$, where it is straightforward.
 
 In particular, for $|a| > c_1^{-1}$, there will be an $\alpha\in k^\times$ with $|\alpha a_v|_v \ge 1$ for all $v$. On the other hand, $|\alpha a_v|_v = \frac{\prod_w |\alpha a_w|_w}{\prod_{w\ne v} |\alpha a_w|_w} \le |a|$. 
 
 Let $r = |a| > c_1^{-1}$, and let $[G]^r$ be the set of idele classes of norm $r$. We conclude that $[G]^r$ is contained in the image of the set
 $$ U=\prod_v k_v^{[1,r]},$$
 where $k_v^{[1,r]}$ denotes the elements of $k_v$ of absolute value in the interval $[1,r]$. For all but a finite number of $v$'s, this is the same as $k_v^{[1,1]}=\mathfrak o_v^\times$, since the valuation is discrete and the residual degree is $> r$ (for almost all $v$).
 
 Thus, the set $U$ is compact in $G(\mathbb A)$, and so is $[G]^r$. But $[G]^r$ is a torsor for $[G]^1$, therefore $[G]^1$ is compact.
 
 The rest are left to the reader.
\end{proof}


Notice that this implies the Dirichlet unit theorem:

\begin{proposition}
 \label{proposition-Dirichlet-unit}
If $F$ is a number field, with $r_1$ real places and $r_2$ complex places, then the unit group $\mathfrak o^\times$ is a finitely generated abelian group of rank $r_1+r_2-1$.
\end{proposition}

\begin{proof}
 If $K = \prod_{v<\infty} \mathfrak o_v^\times$, then $[\mathbb G_m] = k^\times_\infty /\mathfrak o^\times$, and the logarithm of the Archimedean absolute values define a surjection $k^\times_\infty \to \mathbb R^{r_1+r_2}$ with compact kernel. This kernel, intersected with the discrete subgroup $\mathfrak o^\times$, is finite (the torsion subgroup of $\mathfrak o^\times$), while the image of $\mathfrak o^\times$ will be a discrete subgroup, and by Proposition \ref{proposition-automorphic-Gm} it will be cocompact inside the kernel of $\mathbb R^{r_1+r_2}\xrightarrow{\sum} \mathbb R$. Therefore, it is a finitely generated abelian group of rank $r_1+r_2-1$.
\end{proof}




\subsection{Tori}
\label{subsection-tori}

\begin{proposition}
\label{proposition-automorphic-tori}
 Let $T$ be a torus over $k$. Let $X^*_k(T)$ be the $k$-character group of $T$, and $\mathfrak a = \Hom(X^*_k(T) , \mathbb R)$. The map $X^*_k(T) \times [T] \ni (\chi, t) \mapsto \log(|\chi(t)|)$ defines a homomorphism $\log_T:[T]\to\mathfrak a$ with compact kernel and cokernel. In particular, $[T]$ is compact if and only if $T$ is anisotropic.  
\end{proposition}

\begin{proof}
 The only nontrivial statement is that the kernel of $\log_T$ is compact.  Let $[T]^1$ be this kernel (and similarly for any torus). 
 
 First, reduce to the case when $T$ is anisotropic: if $T_1$ is the kernel of all morphisms to $\mathbb G_m$, the quotient $T/T_1$ is isomorphic to $\mathbb G_m^r$ for some $r$, and we have a map $[T]^1 \to [T/T_1]^1$ with kernel $[T_1]$. The case of $\mathbb G_m$ has already been treated in Proposition \ref{proposition-automorphic-Gm}, so we are reduced to the case $T=T_1$, i.e., $T$ is anisotropic.
 
 Assume this to be the case. By Lemma \ref{algebraicgroups-lemma-induced-tori}, there is an induced torus $S$, together with a surjection $S\twoheadrightarrow T$. If $S_1$ denotes the common kernel of all characters of $S$, since $T$ is anisotropic, we have a surjection $S_1\twoheadrightarrow T$. By Proposition \ref{proposition-automorphic-Gm}, $[S_1]$ is compact. On the other hand, the image of the map $[S_1]\to [T]$ will have finite index modulo any compact open subgroup of $T(\mathbb A)$ (exercise!). Therefore, $[T]$ is compact.
\end{proof}

\begin{remark}
 \label{remark-Dirichlet-unit-torus}
 Generalizing the Dirichlet unit theorem \ref{proposition-Dirichlet-unit}, for a torus $T$ over $\mathbb Q$, the group $T(\mathbb Z)$ is a finitely generated abelian group of rank equal to $\mbox{splr}_{\mathbb R}(T) - \mbox{splr}_{\mathbb Q}(T)$, where $\mbox{splr}$ denotes the split rank (the rank of the character group) of the torus over the indicated field.
\end{remark}



\section{Boundary degenerations}
\label{section-boundary-degenerations}

When studying the geometry and harmonic analysis of the space $[G]$, a very important role is played by certain related $G(\mathbb A)$-homogeneous spaces, that we will call \emph{boundary degenerations}. The term is not standard, but is borrowed from \cite{Sakellaridis-Venkatesh}, where it was used in a local setting, and it is a useful concept that unifies the ideas of harmonic analysis globally and locally.

\begin{definition}
 \label{definition-pre-flag}
Let $G$ be a reductive group over a field $k$, let $\mathcal P$ denote a (conjugacy) class of parabolics in $G$, and let $R$ be a trivializable $G$-torsor. The {\it pre-flag variety} [can someone suggest a better term?] associated to these data is the variety classifying pairs $(P, Z)$, where $P\in \mathcal P$ and $Z$ is an orbit for the action of the unipotent radical $U_P$ on $R$. The {\it degenerate pre-flag variety} associated to these data is the variety classifying pairs $(P, Z)$, where $P\in \mathcal P$ and $Z$ is an orbit for the action of the derived group $[P,P]$ on $R$.
\end{definition}

In other words, up to choosing a base point, the pre-flag variety (resp.\ degenerate pre-flag variety) is isomorphic to $U_P\backslash G$ (resp.\ $[P,P]\backslash G$) --- but the definition is formulated in a way to avoid having a chosen base point. For example, if $\mathcal P=\{G\}$, then the pre-flag variety is simply a $G$-torsor. Note that, if $Y$ is such a pre-flag variety and we fix a point $y = (P,Z)\in Y$, through its action on $y$ the $G$-automorphism group of such pre-flag variety can be identified with the Levi quotient $P\twoheadrightarrow L$ of $P$. (Choice of different point will modify this identification by conjugation.)
Clearly, the isomorphism class of the pre-flag variety depends only on the conjugacy class of $\mathcal P$, but the existence of $G$-automorphisms does not allow us to fix a canonical isomorphism between two of those. We will often abuse language, pick a parabolic $P \in \mathcal P$, and say that $U_P\backslash G$ is ``the'' pre-flag variety associated to $P$ --- but without a fixed point, unless otherwise stated.

\begin{remark}
\label{remark-preflag-Borel}
When $\mathcal P = \mathcal B$, the class of Borel subgroups, there is an alternative definition of the associated pre-flag variety: Recall from Proposition \ref{algebraicgroups-proposition-universal-Cartan} that there is a canonical, constant group scheme $\mathbf A^G\times \mathcal B$ over $\mathcal B$, whose fiber at every point $B$ comes with an identification with the reductive quotient of $B$. Then, an associated pre-flag variety is a $G$-equivariant $\mathbf A^G$-torsor over $\mathcal B$, pointwise trivializable, where any Borel subgroup $B$ acts on the fiber over $B\in \mathcal B$ through its quotient $\mathbf A^G$. 
\end{remark}

The definition, of course, begs to remove the ``trivializable'' condition; then, we would end up with homogeneous spaces for inner forms of $G$.


\begin{definition}
 \label{definition-boundary-degeneration}
Let $G$ be a reductive group over a global field $k$, and $\mathcal P$ a class of parabolics. Fix a pre-flag variety $Y$ associated to $\mathcal P$.
The {\it boundary degeneration} $[G]_{\mathcal P}$ of the automorphic space $[G]$ associated to these data is the set of pairs $(y \in M)$, where $M$ is a $G(\mathbb A)$-translate of $Y(k)$ in $Y(\mathbb A)$, and $y\in M$,  modulo the action of $\text{Aut}^G(Y)(k)$. 

Equivalently, fixing a base point $P\in \mathcal P(k)$ with unipotent radical $U$ and Levi quotient $L$, the boundary degeneration $[G]_{\mathcal P}$, which by abuse of notation will also be denoted by $[G]_P$, is the space $L(k)U(\mathbb A)\backslash G(\mathbb A)$.
\end{definition}

\begin{remark}
 \label{remark-boundary-degeneration}
For a different choice of parabolic $P'= L' U'\in \mathcal P(k)$, there is a canonical isomorphism $ L(k)U(\mathbb A)\backslash G(\mathbb A) \simeq L'(k)U'(\mathbb A)\backslash G(\mathbb A)$, induced by translation by an element of $G(k)$, which is unique modulo left $P(k)$-translation. Hence, in this case, there is no ambiguity in saying that $[G]_{\mathcal P}$ is ``the'' space $L(k)U(\mathbb A)\backslash G(\mathbb A)$.
\end{remark}

\begin{remark}
 \label{remark-bdrydegen-as-induction}
Here is an alternate, and more straightforward construction of the boundary degeneration: For every class $\mathcal P$ of parabolics over $k$, the Levi quotients $L$ of any two elements of $\mathcal P$ are isomorphic, canonically up to $L(k)$-conjugacy. (As in the case of the universal Cartan: the parabolics are conjugate by an element of $G(k)$ unique up to multiplication by $P(k)$.)

Choosing such a parabolic with Levi quotient $L$, we have 
\begin{equation}
 \label{equation-bdrydegen-as-induction}
[G]_P = [L]\times^{P(\mathbb A)} G(\mathbb A).
\end{equation}
One easily checks that for any two parabolics, any element of $G(k)$ conjugating one to another defines the same isomorphism between the corresponding spaces defined by \eqref{equation-bdrydegen-as-induction}.

Finally, another way to define the same space is the following: Consider $\mathcal P$ as an algebraic variety, and consider the space
$$ Z= \mathcal P(k)\times^{G(k)} G(\mathbb A).$$
If we choose a $P\in \mathcal P(k)$, this is isomorphic to $P(k)\backslash G(\mathbb A)$. Now, the inertia group scheme of $\mathcal P$ has fiber $P$ over the point $P$, and its unipotent radical is a group scheme $\mathbf U\to \mathcal P$. If we divide the space $Z$, which lives over $\mathcal P(\mathbb A)$, by the action of $\mathbf U(\mathbb A)$, we obtain the space $[G]_P$.
\end{remark}


The importance of boundary degenerations lies in the fact that, as we will see, they model the space $[G]$ ``at infinity'', while having a larger group of symmetries:

\begin{lemma}
 \label{lemma-boundary-automorphisms}
Let $[G]_P$ be a boundary degeneration of the automorphic space, and let $Z$ be the center of the Levi quotient of $P$. The $G(\mathbb A)$-automorphism group of $[G]_P$ is identified with $[Z]$, through its action descending from the action on the pre-flag variety.
\end{lemma}

\begin{proof}
 The $G(\mathbb A)$-automorphism group is the quotient of the normalizer of $H:=L(k)U(\mathbb A)$ by $H$. The closure of the projection of $H$ to any place $v$ of $k$ is the parabolic $P(k_v)$, and since $P$ is self-normalizing, an adele of $G$ normalizing $H$ must lie in $P(\mathbb A)$. Then it acts on $L(\mathbb A)$ by conjugation, and in order to normalize $L(k)$ it has to belong to the center of $L(\mathbb A)$. 
\end{proof}


We will use the action of this abelian group in order to construct (partial) compactifications of the boundary degeneration (and, later, of the automorphic space). There are several slight variants of how to do it, but they all follow the same idea: Let $H\subset [Z]$ (with notation as in Lemma \ref{lemma-boundary-automorphisms}) be a subgroup, and let $\bar H$ be a partial compactification of $H$ (or a partial compactification of a $H$-torsor). Then, we can form the space 
$$\bar H \times^H [G]_P,$$
which is a partial compactification of $[G]_P$. Here, $A\times^H B$ denotes the \emph{topological} quotient of the product $A\times B$ by the action of $H$, i.e., by the equivalence relations $(ah,b) \sim (a, hb)$, $h\in H$.

In practice, $H$ will be the points of a torus and, $\bar H$ will arise from some toric variety. 
For what follows, if $T$ is any torus over a field $F$, we denote by the corresponding gothic lowercase letter the vector space $\mathfrak t:= \Hom(\mathbb G_m, T) \otimes \mathbb R$. If $F$ is a valued field (or ring), we have a well-defined logarithmic map
\begin{equation}
\label{equation-logmap}
\log: T(F)\to \mathfrak t
\end{equation}
given by $\left<\log(t), \chi\right> = \log|\chi(t)|$ for any $\chi\in \Hom(T,\mathbb G_m)$. The same definition can be given, globally, replacing $T(F)$ by $[T]$, and using the adelic absolute value.

Recall that a normal affine embedding $Y$ of a torus $T$ over a field $k$ is given by a \emph{strictly convex, rational polyhedral cone} $C\subset \mathfrak t$. The faces of this cone are in bijection with $T$-orbits on $Y$, in such a way that cocharacters $\lambda$ in the relative interior of a face are those for which $\lim_{t\to 0} \lambda(t)$ belongs to the corresponding orbit. (A ``face'', here, is the intersection with the kernel of a linear functional $\chi$ such that $\chi|_C \ge 0$; this way, $\{0\}$ is a face.) The bijection is closure-reversing, e.g., $\{0\}$ corresponds to the open orbit $T$, and the relative interior of $C$ corresponds to the unique closed orbit. More general normal embeddings of $T$ are described by \emph{fans} in $\mathfrak t$, i.e., collections of such cones closed under the operation of passing to a face of a cone and with disjoint relative interiors. 

Returning to our group $G$, let $\mathbf A^G$ be its universal Cartan (Definition \ref{algebraicgroups-definition-universal-Cartan}), and let $A\subset \mathbf A^G$ be its maximal split subtorus. 
We denote by $\mathfrak a^+\subset \mathfrak a$ the antidominant cone, and by $\mathfrak a^+_{ss}\subset \mathfrak a^+$ its intersection with the weight space of the associated semisimple group. Faces of $\mathfrak a^+$ (or $\mathfrak a^+_{ss}$) correspond to conjugacy classes of parabolic subgroups defined over $k$, and the span of the face $\mathfrak a_P^+$ (resp.\ $\mathfrak a_{ss,P}^+$) associated to $P$ will be denoted by $\mathfrak a_P$ (resp.\ $\mathfrak a_{ss,P}^+$). The center $Z$ of a Levi quotient as in Lemma \ref{lemma-boundary-automorphisms} is canonically a subgroup of $\mathbf A^G$, and the cocharacters in $\mathfrak a_P$ span the maximal split subtorus $A_P$ of $Z$.

Now, the face $\mathfrak a_{ss,P}^+\subset \mathfrak a_P$ defines an affine embedding $A_P \hookrightarrow \overline{A_P}$. We can define a corresponding partial compactification $\overline{[G]_P}$ of $[G]_P$, by either of the construction in the following definition:

\begin{definition}
 \label{definition-standard-embedding}
A {\it standard embedding} of the space $[G]_P$ is either of the following spaces:
\begin{itemize} 
 \item $\overline{A_P(k_\infty)^0} \times^{A_P(k_\infty)^0} [G]_P$, where $\overline{A_P(k_\infty)^0}$ is the closure of the identity component of $A_P(k_\infty)$ in $\overline{A_P}(k_\infty)$. This makes sense only if $k$ is a number field. When $k=\mathbb Q$ (which we can always assume, by restriction of scalars), it leads to the so-called \emph{reductive Borel--Serre compactification} \cite{Zucker-L2, Borel-Ji}. 
 \item $\overline{A_P}(k_\infty) \times^{A_P(k_\infty)} [G]_P$. Recall that, in the function field case, we just pick a place (or a place of the base field) that we call infinity.
 \item $\overline{A_P}(k)A_P(\mathbb A) \times^{A_P(\mathbb A)} [G]_P$. Here, $\overline{A_P}(k)A_P(\mathbb A)$ is the subset of ``primitive elements'' in $\overline{A_P}(\mathbb A)$. Notice that $A_P(\mathbb A)$ is not open in the space $\overline{A_P}(\mathbb A)$, but it is open in the subset of primitive elements (with the induced topology). 
\end{itemize}
\end{definition}


\begin{lemma}
 \label{lemma-manifold-corners}
Assume that $k=\mathbb Q$, and let $K\subset G(\mathbb A_f)$ be a compact open subgroup. The space $\overline{A_P(\mathbb R)^0} \times^{A_P(\mathbb R)^0} [G]_P/K$ has the structure of a manifold with corners, so that the quotient $\overline{A_P(\mathbb R)^0} \times [G]_P/K \to \overline{A_P(\mathbb R)^0} \times^{A_P(\mathbb R)^0} [G]_P/K$ is an ${A_P(\mathbb R)^0}$-torsor in manifolds with corners. 
\end{lemma}

\begin{proof}
 The space $[G]_P/K$, under the $G(\mathbb R)$-action, is a union of homogeneous manifolds, and the space $\overline{A_P(\mathbb R)^0}$ is a manifold with corners (isomorphic to a product of copies of $\mathbb R_{>0}$ and $\mathbb R_{\ge 0}$) . The stabilizer for the action of $A_P(\mathbb R)^0$ on it is a compact subgroup, hence trivial, and therefore the quotient of $\overline{A_P(\mathbb R)^0} \times [G]_P/K$ by the action of $A_P(\mathbb R)^0$ inherits the structure of a manifold with corners.
\end{proof}

There is some coarser topology than the manifold topology that these spaces have, in the number field case, namely some sort of ``semialgebraic'' topology. This plays a role in harmonic analysis; we will return to it when appropriate.

Finally, we introduce the notion of the cusp:
\begin{definition}
 \label{definition-P-cusp}
 Consider a standard embedding $[G]_P \subset \overline{[G]_P}$, as in Definition \ref{definition-standard-embedding}. The {\it $P$-cusp} in $\overline{[G]_P}$ is the closed $G(\mathbb A)$-orbit. A {\it neighborhood of the $P$-cusp} in $[G]_P$ is the intersection of $[G]_P$ with a neighborhood of the $P$-cusp in $\overline{[G]_P}$. When $P$ is the class of minimal parabolics, the $P$-cusp will simply be called ``the cusp''.
\end{definition}

Notice that the distinction ``$P$-cusp'', as opposed to ``cusp'', is important: e.g., when $P=G$, the partial compactification $\overline{[G]}$ above is trivial, so the $G$-cusp is $[G]$ itself, but there will be a ``cusp'', which, to define, we first need to discuss reduction theory, and a full compactification. 

\begin{lemma}
\label{lemma-definitions-cusp-equivalent}
All standard embeddings of Definition \ref{definition-standard-embedding} give rise to the same neighborhoods of the $P$-cusp.
\end{lemma}


\begin{proof}
This relies on the ``baby case'' of the partial compactification $\mathbb G_m\hookrightarrow \mathbb G_a$. We leave the rest to the reader.


 \begin{quote}
Under the natural map 
$$ k_\infty \times^{k_\infty^\times} [\mathbb G_m] \to \mathbb A \times^{\mathbb A^\times} [\mathbb G_m] = \mathbb A/k^\times,$$
a basis of neighborhoods of the ``cusp'' (represented by $0\in \mathbb A$) on the right hand side maps to a basis of neighborhoods of the ``cusp'' (represented by $0\in k_\infty$) on the left hand side.
\end{quote}

The map is continuous, so it is enough to show that any element in a basis of neighborhoods $(V_r)_r$ on the left contains the preimage of a neighborhood on the right. Since the cusp is invariant under $[\mathbb G_m]$, and in particular under the compact subgoup $K=[\mathbb G_m]^1$, we can take the basis on the left to be invariant under $K$, and then it is seen that the sets $V_r = \{ x\in [\mathbb G_m], |x|<r\}$  with $r\to 0^+$ form such a basis. If we choose an adele $b$ with $|b|<r$, and let $V'$ be the union of $k^\times$-translates of the set $\{a \in \mathbb A, \forall v:  |a_v|\le |b_v|\}$, then $V'$ is open, and its preimage belongs to $V_r$. This proves the claim. 

\end{proof}




\begin{remark}
 \label{remark-cusp-Iwasawa}
Let us explicate neighborhoods of the cusp in the case where $G$ is split, hence the minimal parabolic is a Borel subgroup. (A similar description will be valid for the minimal parabolic $P$ in every case, once we show --- Theorem \ref{theorem-reduction-theory-general} --- that $[L']$ is compact, where $L'$ is the derived subgroup of the Levi quotient of $P$.) 

Choose a Borel subgroup $B=AN$, and a maximal compact subgroup $K$ of $G(\mathbb A)$ which satisfies the Iwasawa decomposition $G(\mathbb A) = B(\mathbb A)K$. 
 Then, for \emph{any} identification $\bar Y = N\backslash G$ over $k$, a basis of neighborhoods of the cusp in $[G]_B$ is given by the neighborhoods $V_\epsilon := N(\mathbb A)[A]^{\le \epsilon}  K$ (as $\epsilon\to 0^+$), where $[A]^{\le \epsilon}$ is the set of elements $a$ with $|e^\alpha(a)|\ge \epsilon^{-1}$ for all positive roots $\alpha$. 
\end{remark} 

We reformulate the definition of the $P$-cusp, when the last choice of standard embedding in Definition \ref{definition-standard-embedding} is made: Let $Y$ be the pre-flag variety $U\backslash G$. The action of $A_P$ by $G$-automorphisms allows us to define a (so-called \emph{toroidal}) partial compactification $\bar Y\supset Y$, as $\bar Y = \overline{A_P} \times^{A_P} Y$, where $\overline{A_P}$ is the affine embedding defined by the wall of the (semisimple) antidominant chamber, as above. In particular, $\bar Y$ contains a closed $G$-orbit $Y_0$, which we will call \emph{the $P$-cusp in $\bar Y$}. Now, consider an $\text{Aut}^G(Y)(k)$-stable neighborhood $V$ of $Y_0(\mathbb A)$ in $\bar Y(\mathbb A)$ --- recall that $\text{Aut}^G(Y)$ is identified with the Levi quotient of $P$, once we fix a point whose stabilizer is the unipotent radical of $P$. Notice also that $Y(\mathbb A)$ is not open in $\bar Y(\mathbb A)$ --- but it doesn't matter! All that matters is the subset $\bar Y(k)G(\mathbb A)$ of ``primitive'' elements, where $Y(\mathbb A)$ is open.

Now recall from Definition \ref{definition-boundary-degeneration} that $[G]_P$ is defined as the set of pairs $(M,y)$ modulo $\text{Aut}^G(Y)(k)$, where $M$ is a $G(\mathbb A)$-translate of $Y(k)$, and $y\in M$. Let $\tilde V\subset [G]_P$ be the subset given by the condition $y\in V$. Then, the neighborhoods of the $P$-cusp in $[G]_P$ are precisely the sets of the form $\tilde V$, where $V$ is an $\text{Aut}^G(Y)(k)$-invariant neighborhood of the $P$-cusp in $\bar Y$, and $\tilde V$ is obtained from $V$ as above.



We will now modify this description to define a degenerate version of the $P$-cusp, that leads to a coarser collection of ``neighborhoods of infinity''. Let $Y_{deg}$ be the degenerate pre-flag variety $[P,P]\backslash G$. Again, the action of $A_P$ by $G$-automorphisms allows us to define a partial compactification $\bar Y_{deg}\supset Y_{deg}$, as $\bar Y_{deg} = \overline{A_P} \times^{A_P} Y_{deg}$, where $\overline{A_P}$ is the affine embedding defined by the wall of the (semisimple) antidominant chamber, as above. In particular, $\bar Y_{deg}$ contains a closed $G$-orbit $Y_{deg,0}$, which we will call \emph{the degenerate $P$-cusp in $\bar Y_{deg}$}. Now, consider an $L^{ab}(k)$-stable neighborhood $V_{deg}$ of $Y_{deg,0}(\mathbb A)$ in $\bar Y_{deg}(\mathbb A)$, where $L^{ab}$ is the abelianization of $L=\text{Aut}^G(Y)$.

Using again Definition \ref{definition-boundary-degeneration} for $[G]_P$ as the set of pairs $(M,y)$ modulo $\text{Aut}^G(Y)(k)$, we let $\tilde V\subset [G]_P$ be the subset given by the condition $\bar y\in V_{deg}$, where $\bar y$ is the image of $y$ under $U\backslash G\to [P,P]\backslash G$. In other words, these are neighborhoods of the cusp obtained from neighborhoods $V\subset U\backslash G(\mathbb A)$, as before, except that $V$ should be stable under the commutator of the Levi. 

\begin{definition}
 \label{definition-degenerate-P-cusp}
 A {\it neighborhood of the degenerate $P$-cusp} in $[G]_P$ is a set of the form $\tilde V$ as above, where $V$ is a neighborhood of the degenerate $P$-cusp in $\bar Y_{deg}(\mathbb A) = \overline{[P,P]\backslash G}(\mathbb A)$.
\end{definition}

Hence, a neighborhood of the degenerate $P$-cusp in $[G]_P$ is a neighborhood of the $P$-cusp, but a neighborhood of the $P$-cusp is a neighborhood of the degenerate $P$-cusp only when it is the preimage of a set under the map 
$$ L(k)U(\mathbb A)\to G(\mathbb A) \to L^{ab}(k)[P,P](\mathbb A)\backslash G(\mathbb A).$$
Of course, the two notions coincide when $P$ is in the class of Borel subgroups.

\section{Adelic heights, and the case of $\text{SL}_2$}
\label{section-adelic-heights}


\begin{definition}
 \label{definition-adelic-height}
An \emph{adelic height} on a vector space $V$ over $k$ is a function of the form $\Vert x\Vert = \prod_v \Vert x_v \Vert_v$ on $V(\mathbb A)$, where:
\begin{itemize}
 \item $\Vert \bullet \Vert_v$ is a norm on $V(k_v)$, i.e., a subadditive, $\mathbb R_{\ge 0}$ valued function that is zero only at $0$ and satisfies $\Vert a x \Vert_v = |a|_v \cdot \Vert x \Vert_v$ for every $a\in k_v$, $x\in V(k_v)$;
 \item there is a basis of $V$ over $k$ such that for almost every non-Archimedean place, $\Vert x\Vert_v$ is the maximum of the absolute values of the coordinates of $x$ in that basis.
\end{itemize}
\end{definition}

Obviously, the factors of the product are almost all equal to $1$ if $x\in (V\smallsetminus\{0\})(\mathbb A)$, but the height extends continuously by zero to the entire space $V(\mathbb A)$ (though we will never use that).


\begin{lemma}
 \label{lemma-height-functions}
Adelic height functions (Definition \ref{definition-adelic-height}) on a vector space $V$ have the following properties:
\begin{enumerate}
 \item For any two height functions $\Vert \bullet \Vert'$, $\Vert\bullet\Vert''$, the quotient $\frac{\Vert\bullet\Vert'}{\Vert\bullet\Vert''}$ is bounded in $\mathbb R_{>0}^\times$.
 \item For all $a\in \mathbb A^\times$, $x\in V(\mathbb A)$, we have $\Vert a x \Vert = |a|\cdot \Vert x \Vert$; in particular, $\Vert \bullet \Vert$ is invariant under $k^\times$-multiplication.
 \item The restriction of $\Vert\bullet\Vert$ to the quotient space $k^\times \backslash V(k)\cdot \text{GL}_V(\mathbb A) = k^\times\backslash (V^*(\mathbb A)\cup \{0\})$, where $V^*$ denotes the complement of zero, defines a basis of neighborhoods of zero.
 \item For every $g\in \text{GL}_V(\mathbb A)$ and any $c>0$, there is only a finite number of classes $[y]\in k^\times \backslash V(k)$ such that $\Vert y\Vert <c$; in particular, the set $\Vert V^*(k)g\Vert$ has a minimum.
\end{enumerate}

\end{lemma}

\begin{proof}
 Left to the reader.
\end{proof}


Let us now discuss the case of $G=\text{SL}_2$, with its standard representation $V$. Notice that $V^*=V\smallsetminus\{0\}$ can be identified with the pre-flag variety $Y$ for the class of Borel subgroups of $G$ (Definition \ref{definition-pre-flag}), and $V$ is simply its affine closure, i.e., $V= \text{Spec} k[Y]$. In this case, the cusp can also be defined with the help of the affine embedding $V$, instead of the toroidal embedding $\bar Y$. That is, instead of choosing a $k^\times$-invariant neighborhood of the cusp $U$ in $\bar Y(\mathbb A)$, one can choose a $k^\times$-invariant neighborhood $U$ of zero in $V(\mathbb A)$, and pull it back to $B(k)\backslash G(\mathbb A)$ to define a neighborhood of the cusp there. By Lemma \ref{lemma-height-functions}, a basis of such neighborhoods of zero is determined by height functions.


\begin{remark}
 \label{remark-basic-affine}
We caution the reader that, in higher rank, the affine embedding $\bar Y^{\text{aff}}=\overline{N\backslash G}^{\text{aff}} = \text{Spec} k[N\backslash G]$ (where $G$ is assumed split semisimple, and $N$ is a maximal unipotent subgroup) is \emph{not} the appropriate space to define the cusp, i.e., not every neighborhood of the cusp in $[G]_B$ is the pullback of an $A(k)$-invariant neighborhood of ``zero'' (=the unique $G$-fixed point) in $Y^{\text{aff}}(\mathbb A)$. 

In terms of toric varieties, this is because the toroidal embedding of $Y$ used in the definition of the $P$-cusp corresponds to the antidominant Weyl chamber, while the affine closure $Y^{\text{aff}}$ corresponds to the \emph{negative root cone}, in the sense that it admits a blowup $\tilde Y \to \bar Y^{\text{aff}}$, with $\tilde Y = \tilde A\times^A Y$, and $\tilde A$ is the affine embedding of $\tilde A$ corresponding to the negative root cone. Thus, $A(k)$-invariant neighborhoods of zero in $Y^{\text{aff}}(\mathbb A)$ are \emph{much larger} than neighborhoods of the cusp, in higher rank, and the latter cannot be defined using adelic heights on an affine embedding of $Y$.
\end{remark}

Now, we formulate the main theorem of reduction theory for $G=\text{SL}_2$:

\begin{theorem}
 \label{theorem-reduction-SL2}
Let $G = \text{SL}_2$, and consider the maps 
\begin{equation}
\label{equation-leftrightSL2} 
\xymatrix{
& B(k)\backslash G(\mathbb A) \ar[dl]_{\pi_G}\ar[dr]^{\pi_B}& \\
[G] && [G]_B. 
}\end{equation}
Fix an adelic height function $\Vert \bullet \Vert$ (Definition \ref{definition-adelic-height}) on the space $V$ of the standard representation of $G$, and for every $\epsilon >0$, let $U_\epsilon$ be the preimage in $[G]_B$ of the set of points $y\in Y(\mathbb A)$ (where $Y=V^*=V\smallsetminus\{0\}$) with $\Vert y \Vert <\epsilon$, and $\tilde U_\epsilon$ its preimage in $B(k)\backslash G(\mathbb A)$.

Then, for $\epsilon$ sufficiently small, the map $\pi_G|_{\tilde U_\epsilon}$ is injective, while for $\epsilon$ sufficiently large, $\pi_G|_{\tilde U_\epsilon}$ is surjective. In particular, for every $\epsilon$, the complement of $\pi_G({\tilde U_\epsilon})$ is relatively compact in $[G]$.
\end{theorem}

\begin{proof}
 Injectivity: It suffices to show that, if $\epsilon$ is sufficiently small, for any $g\in G(\mathbb A)$ the set $\{y \in Y(k)g| \Vert y\Vert <\epsilon\}$ contains at most one $k^\times$-orbit.
 
 Hence, fix $[g]\in [G]$, and let us also fix the point $y_0 =(0,1)\in Y$, so that its image in the flag variety is stabilized by the upper triangular Borel subgroup $B$. Let us fix a good maximal compact subgroup $K$ that satisfies the Iwasawa decomposition $G(\mathbb A) = B(\mathbb A)K$, and we may without loss of generality assume that the adelic norm $\Vert \bullet \Vert $ is $K$-invariant. Assume that $y\in Y(k)g$ has height $<\epsilon$. We may choose a representative $g\in G(\mathbb A)$ for $[g]$ such that $y = y_0 g$.  
 Writing $g = bk$ according to the Iwasawa decomposition, we have $ b = \begin{pmatrix} a & r \\ & a^{-1}\end{pmatrix}$, and $ \Vert y_0 g\Vert = \Vert y_0 b\Vert = \Vert a^{-1} y_0\Vert = |a|^{-1} \Vert y_0\Vert$, so $|a| > \epsilon^{-1} \Vert y_0\Vert$. 
 
 Our goal is to show that, if $\epsilon$ is sufficiently small (independently of $[g]$), any other element $z\in Y(k)g$ with height $<\epsilon$ is a $k^\times$-multiple of $y$. If not, we have $z = z_0 g$ with $z_0 = (\kappa, \lambda) \in k^2$ with $\kappa\ne 0$. Up to the $k^\times$-action, we may assume that $\kappa=1$. But $\Vert z_0 g\Vert = \Vert z_0 b\Vert$, and $\Vert z_0 b\Vert = \Vert (a , r + a^{-1} \lambda)\Vert$. It is now clear from the definition of heights that if $\epsilon$ is sufficiently small, so that $|a|$ is sufficiently large, the last expression is $>\epsilon$.
 
 (For a more geometric, and conceptual, version of the same argument, see the proof of the general case in Theorem \ref{theorem-reduction-theory-split}.)
 
 Surjectivity: Vice versa, it suffices to show that if $\epsilon$ is large enough, then for every $[g]\in [G]$ the set $\{y\in Y(k)g | \Vert y\Vert >\epsilon\}$ is nonempty. Given $[g]$, we may choose a representative $g\in G(\mathbb A)$ so that $\Vert y_0 g\Vert$ is minimal in $\Vert Y(k)g\Vert$. (The minimum exists, by Lemma \ref{lemma-height-functions}.) Write $g = bk$ by the Iwasawa decomposition, where $b = \begin{pmatrix} a & r \\ & a^{-1}\end{pmatrix}$. The minimality of $\Vert y_0 g\Vert$ implies that 
 $\Vert (a , r + a^{-1} \lambda)\Vert \ge \Vert y_0 g\Vert = |a|^{-1} \Vert y_0 \Vert$ for all $\lambda\in k$, hence $|a|^2 \ge \frac{\Vert y_0\Vert }{\Vert (1 , a^{-1} r + a^{-2} \lambda)\Vert}$. The denominator is bounded away from zero, giving a lower bound for the absolute value of the positive root $|e^\alpha(b)| = |a|^2$, and an upper bound for $\Vert y_0 g\Vert = |a|^{-1} \Vert y_0 \Vert$. Hence, if $\epsilon$ is larger than this upper bound, the class of $[g]$ is represented in $\tilde U_\epsilon$.
 
 
\end{proof}





\section{Reduction theory and compactifications in the split case}
\label{section-reduction-theory-split}

Reduction theory is the description of the space $[G]$ ``at infinity'' in terms of its boundary degenerations. 

More precisely, fix a class $\mathcal P$ of parabolics, and a parabolic $P\in \mathcal P(k)$. (Nothing will depend on $P$, but it is notationally convenient.)
Consider the homogeneous space $\mathcal P(k)\times^{G(k)} G(\mathbb A) = P(k)\backslash G(\mathbb A)$, already encountered in Remark \ref{remark-bdrydegen-as-induction}. It admits a pair of quotient maps:
\begin{equation}
\label{equation-leftright} 
\xymatrix{
& P(k)\backslash G(\mathbb A) \ar[dl]_{\pi_G}\ar[dr]^{\pi_P}& \\
[G] && [G]_P,
}\end{equation}
and notice that $\pi_G$ is a local homeomorphism, while $\pi_P$ has compact fibers.


We will call ``neighborhood of the (degenerate) $P$-cusp'' in $P(k)\backslash G(\mathbb A)$ the preimage of any neighborhood of the (degenerate) $P$-cusp in $[G]_P$. Generally, for a neighborhood $V$ of the $P$-cusp in $[G]_P$, we will use the notation $\tilde V$ for its preimage in $P(k)\backslash G(\mathbb A)$. Recall that the $P$-cusp is a $G(\mathbb A)$-orbit in a certain partial compactification $\overline{[G]_P}$ of $[G]_P$, see Definition \ref{definition-P-cusp}. A ``scaling'' of such a neighborhood will be the neighborhood that we obtain from it by the action of an element $a\in A_P(\mathbb A)$ on $[G]_P$.

In this section, we will prove the main result of reduction theory in the split case. We will use it to define a certain compactification of $[G]$, which will be used in the next section to address the general case.

\begin{theorem}
 \label{theorem-reduction-theory-split}
Let $G$ be a split reductive connected group over $k$, and $P\subset G$ a (class of) parabolic(s).
 \begin{description}
  \item[(I)] Every compact subset of the $P$-cusp in $\overline{[G]_P}$ has a neighborhood $V$ such that $\pi_G|_{\tilde V}$ is injective, where $\tilde V$ is the preimage of $V$ in $P(k)\backslash G(\mathbb A)$.\footnote{Obviously, ``every compact subset'' is superfluous, but we include it to stress that there is no uniformity in the choice of neighborhood.}
  \item[(S)] Every $[A_G]$-invariant neighborhood of the degenerate $P$-cusp in $[G]_P$ (where $A_G$ is the maximal split torus in the center of $G$) can be scaled to a neighborhood $V$ such that $\pi_G|_{\tilde V}$ is surjective, where $\tilde V$ is as above. 
 \end{description}
\end{theorem}


\begin{proof}
There are two approaches to proving this theorem: One, due to Borel and Harish-Chandra \cite{Borel-HC}, is to prove it first for $\text{GL}_n$ over $\mathbb Q$, and then deduce it for a general reductive group via an embedding $G\to \text{GL}_n$ (where $G$, by restriction of scalars, can be considered as a group over $\mathbb Q$, at least in the number field case. Here and in the next section, we will present the second, as developed by Mostow--Tamagawa \cite{Mostow-Tamagawa}, Godement \cite{Godement-domaines-fondamentaux}, and finally Springer \cite{Springer-reduction-theory}. [We caution that there are crucial omissions in some of these papers that make the proofs confusing, or even incomplete; the presentation here is heavily reformulated.]

Having addressed the case of split tori in Proposition \ref{proposition-automorphic-Gm}, we will now assume that $G$ is semisimple; the combination of the two to address the general case is ``easy'', and left to the reader. 


We discuss the injectivity statement, (I). Let $Y=N\backslash G$ be ``the'' pre-flag variety for $G$. In order to keep track of possible limits in various directions, let us consider a full compactification of the torus $A$. It will not be important which compactification we will consider, as long as $\bar A$ admits an open embedding in it, but to fix ideas, let us temporarily take $\bar A^F$: the compactification corresponding to the fan $F$ consisting of all Weyl chambers (and their faces), and let $\bar Y^F = \bar A^F \times^A Y$ --- it is a proper variety over the flag variety $\mathcal B$, and it contains the compacification $\bar Y$ used to define the cusp. The fixed points of $A$ on $\bar A^F$, and the closed orbits of $G$ on $\bar Y^F$, are canonically parametrized by the Weyl group, if we let the fixed point in $\bar A$ correspond to $1$, and then proceed equivariantly according to the \emph{right} action of $W$ on $\mathfrak a$. 

Choose a Borel subgroup $B\in \mathcal B(k)$, and a section of the canonical map $B\to A$, and denote its image by $T$; hence, $T$ is a maximal torus in $B$, identified with $A$ through the quotient map. We use $\bar T$, $\bar T^F$ etc.\ for $T$, as for $A$. For every $B'\in \mathcal B$ and any strictly antidominant cocharacter $\lambda$ into $T$, we have $\lim_{x \to 0} B'^{\lambda(x)} = B^w$, for some $w$ in the Weyl group of $W$ --- this is the Bruhat decomposition!  

Suppose $y'\in Y$ lies over $B'$, and $w$ is as above; then, $y' = y_0 \tilde w$, for a $y_0$ over $B$, and some representative $\tilde w$ of $w$ in the normalizer of $T$.
The proof of (I) relies on the second of the following statements on limits on $\bar Y^F$; the first is stated just for the reader's interest:  

\begin{itemize}
 \item If $\lambda:\mathbb G_m\to T$ is strictly dominant, then $\lim_{x\to 0} y_0 \tilde w\cdot \lambda(x) \in \bar Y^F$ is the $A$-fixed point in the fiber over $B^w$ which corresponds to $w$. 

 \item The closure $\overline{y_0 \tilde w N}\subset \bar Y^F$ intersects the fiber over $B$ (=the unique fixed point/closed orbit of $N$ on $\mathcal B$) along the limits of all cocharacters in the relative interior of the cone $R_w^+\subset \mathfrak a$ spanned by the simple coroots $\check\alpha$ such that $w\check\alpha <0$.
\end{itemize}

The second statement means the following: Let $\bar A^{R_w^+}$ be the embedding of $A$ corresponding to the cone $R_w^+$; it has a unique closed orbit (it does not contain what was denoted by $\bar A$ before!), and let $\bar Y^{R_w^+}$ be the corresponding embedding of $Y$. Then, the closure of $y_0 \tilde w N$ in $\bar Y^{R_w^+}$ is projective, and intersects the orbit over $B$ along the closed $A$-orbit. For any other completion such as $\bar Y^F$, there is a blowup of $\bar Y^{R_w^+}$ that maps to $\bar Y^F$, and the closure of $y_0 \tilde w N$ will be contained in the image.

Let us prove the second statement: Since $\bar Y^F =\bar A^F \times^A Y$, the closure of $y_0 \tilde w N$ in $\bar Y^F$ corresponds to the closure of the set $A\cdot (1,y_0\tilde w N)$ in $\bar A^F \times Y$, where $A$ acts by $a\cdot (x,y) = (a^{-1} x, a y)$. Let $Y_w\subset Y$ be the preimage of the closed Bruhat cell $\overline{B w N}$, and $Y_w\sslash N = \text{Spec} k[Y_w]^N$ the affine quotient by $N$. Fixing the base point $\overline{y_0\tilde w}$=the image of $y_0\tilde W$, this is identified with the affine embedding of $A$ with divisors corresponding to the codimension-one $B$-orbits in $Y_w$, which are in bijection with the set of simple roots $\alpha$ such that $w^{-1}\alpha <0$. If $D_\alpha$ is the corresponding divisor in $Y_w\sslash N$, then the valuation it induces on the character group of $A$ is proportional to $-\check\alpha$. Thus, $Y_w\sslash N \simeq \bar A^{R_w^-}$, $A$-equivariantly (after we fix a base point), where $R_w^-$ is the embedding of $A$ corresponding to the opposite cone of $R_w^+$. Passing to the corresponding quotient of $\bar A^F \times Y_w$,  the closure of $A\cdot (1,y_0\tilde w N)$ maps to the closure of $A\hookrightarrow \bar A^F \times \bar A^{R_w^-}$, where the embedding is the antidiagonal one. The projection of this to the first factor is the image of the blowup of the variety $\bar A^{R_w^+}$. Note that this statement and proof does not depend on the choice of compactification $\bar A^F$.

The way that this statement will be applied to our setting, is the following: Fix the base point $y_0\in Y(k)$, and let $B$ be the stabilizer of its $A$-orbit. Fix a maximal compact subgroup satisfying the Iwasawa decomposition $G(\mathbb A) = B(\mathbb A) K$. We use this, together with the logarithmic maps $B(\mathbb A)\to \mathfrak a$, defined as in \eqref{equation-logmap}, to define a ``height'' function  on $[G]_B = A(k)\backslash y_0 G(\mathbb A)$:
$$h(g) = \log(b)\in \mathfrak a.$$ 
This is similar to the height functions of Definition \ref{definition-adelic-height}, except that it does not use an affine embedding of $Y$; rather, the sets $V_\epsilon = \{ [g] \in [G]_B| h(g) > -\log \epsilon\}$ form a basis of neighborhoods for the cusp. (See Remarks  \ref{remark-cusp-Iwasawa} and \ref{remark-basic-affine}.)

We claim that the above statement about the closure of $y_0 \tilde w N$ implies the following:

\begin{itemize}
 \item There is a compact $C_0\subset \mathfrak a$ such that 
\begin{equation}
 \label{equation-bound-height}
h(y_0 \tilde w N(\mathbb A)) \subset C_0 + R_w^+.
\end{equation}
\end{itemize}
[We leave it to the reader to check this corollary, for now.]


Returning to the proof of (I), consider the surjective maps $B(k)\backslash G(\mathbb A)\to P(k)\backslash G(\mathbb A) \to [G]$, for any parabolic $P\supset B$. Fix a compact $\Omega\subset [G]_P$, and consider the subsets $\Omega_\epsilon= [A_P]_\epsilon \cdot \Omega$, where $[A_P]_{\epsilon}$ is the set of elements $a$ with $\left< \alpha,\log(a)\right> -\log \epsilon$ for every simple root $\alpha$ in the unipotent radical of $P$; recall that $\log(a)\in\mathfrak a_P$, for $a\in A_P(\mathbb A)$. These subsets form a basis of neighborhoods of the image of $\Omega$ in the $P$-cusp. In turn, $\Omega$ is contained in the image $\Omega'$ of a compact subset of $B(k)\backslash G(\mathbb A)$ under $B(k)\backslash G(\mathbb A)\to P(k)\backslash G(\mathbb A) \to [G]_P$. Thus, we see
\begin{itemize}
 \item For any $\lambda_0  \in \mathfrak a_P^+$, any countable decreasing basis of compact neighborhoods of $A_P\backslash \Omega$ (in the $P$-cusp) is eventually contained in  the image of a set of the form $h^{-1} (C+\lambda_0 + \mathfrak a_P^+)\subset B(k)\backslash G(\mathbb A)$, where $C$ is a fixed compact subset depending on $\Omega$. 
\end{itemize}

Thus, to prove (I), it suffices to show that, if $\lambda_0$ is sufficiently antidominant (i.e., sufficiently deep in the relative interior of $\mathfrak a_P^+$), any two elements $g, g'\in B(k)\backslash G(\mathbb A)$ with $h(g), h(g')\in C+\lambda_0 + \mathfrak a_P^+$ and the same image in $[G]$, have the same image in $P(k)\backslash G(\mathbb A)$. In other words, we need to show that if $y = y_0 \tilde w \nu$ for $\tilde w\in \mathcal N(T)$ and $\nu\in N(k)$, and $y g = y_0 g'$, then $y \in  y_0 L(k)$. 

Now, on one hand, $h(y g) = h(y_0 g') =  h(g') \in C+\lambda_0 + \mathfrak a_P^+$, by assumption. On the other, writing $g = n t k$ according to the Iwasawa decomposition, we have $h(yg) = h(y_0 \tilde w \nu ntk) \in h(y_0 {^wt} \tilde w N(\mathbb A))$. By \eqref{equation-bound-height}, which translates in the obvious way under the action of $A$, we have $h(y_0 {^wt} \tilde w N(\mathbb A)) \in C_0 + h({^wt}) + R_w^+ \subset C_0 + wC+ w\lambda_0 + w\mathfrak a_P^+$. 
Because $\lambda_0 \in \mathfrak a_P^+$ is antidominant, the difference $w\lambda_0 -\lambda_0$ lies in the cone $R_w^-$. Since $R_w^+\cap R_w^- = \{0\}$, the only way that the intersection 
$$(C+\lambda_0 + \mathfrak a_P^+) \cap  (C_0 + wC+ w\lambda_0 + w\mathfrak a_P^+)$$
can be nonempty, when $\lambda_0$ is sufficiently ``large'' (deep in the interior of $\mathfrak a_P^+$), is that $w$ preserves $\mathfrak a_P^+$; that is, $\tilde w\subset P(k)$. This proves (I).

 
Now we come to the proof of (S). It is enough to prove it for the minimal parabolic (i.e., the Borel). The cusp of $\overline{[G]_B}$ is isomorphic to $\mathcal B(\mathbb A)$, hence compact. Fix an ordering $\alpha_1, \alpha_2, \dots,\alpha_r$ of the simple roots in the root system of $G$, and let $P_i$ be the parabolic which contains $\alpha_j$ with $j\le i$ in its unipotent radical, and $\alpha_j$ with $j>i$ in its Levi. Hence, $P_0=G$ and $P_r=B$. For each $i$, fix a (right) representation $V_i$ and a vector $v_i \in V_i(k)$ such that $v_i$ is an eigenvector for $P_i$, but no larger parabolic. Fix adelic heights on the $V_i$'s, and consider the set 
 $$ \Omega = \{g \in B(k)\backslash G(\mathbb A) | \forall i \ge 1, \forall \gamma \in P_{i-1}(k), \Vert v_i \gamma g \Vert \ge \Vert  v_i g\Vert\}.$$
 Then, by the properties of heights (Lemma \ref{lemma-height-functions}), $G(k)\Omega = G(\mathbb A)$. 
 
 We may fix again a good maximal compact subgroup $K$ with Iwasawa decomposition $G(\mathbb A) = B(\mathbb A)K$, and assume that $V$ is $K$-invariant. Writing an element of $[G]_B$ as $g=bk$, accordingly, and defining a ``height'' function (nothing to do with the adelic height functions defined previously, but this is a standard name) $h(g) = \log(b)\in \mathfrak a$, it is enough to show that $h(\Omega)$ lies in a translate of $\mathfrak a^+$. Such a translate is defined by equations $\left < \lambda, \alpha_i\right> \ge T_i$ for some scalars $T_i$ and any $i=1,\dots ,r$, i.e., we need to show that $\left< h(\Omega, \alpha_i\right>$ is bounded below, for all $i$. 
 
 By induction on $r$, we may assume this to be the case for $i \ge 2$. But then, to show it for $\alpha_1$, we may replace $G$ by the group $G'=$the Levi quotient of the parabolic $Q$ generated by $P$ and the root spaces proportional to $\alpha_1$. Indeed, the condition $\Vert v_1 \gamma g \Vert \ge \Vert v_1 g\Vert$ holds a fortiori for $\gamma \in Q (k)$, and $Q$ acts on $v_1$ through its Levi quotient. Thus, we are reduced to the case of $G$ being of \emph{semisimple rank one}, which we now assume. We may keep assuming that $G$ is semisimple, since the center evidently plays no role. But then we are in the case of $G = \text{SL}_2$, covered in Theorem \ref{theorem-reduction-SL2}, or $\text{PGL}_2$, which is similar. Thus, the theorem is proven. 
\end{proof}

We will now use Theorem \ref{theorem-reduction-theory-split} to construct a compactification of $[G]$. Set-theoretically, the compactification is
$$ {[G]}^{RBS} = \bigcup_P A_P\backslash [G]_P,$$
where $P$ ranges over all conjugacy classes of parabolics, so $A_P\backslash [G]_P$ is the $P$-cusp. Here, we are being a bit ambiguous about the meaning of $A_P$: it depends on which of the ``standard embeddings''  of $[G]_P$ (Definition \ref{definition-standard-embedding}) one chooses; corresponding to the choices in this definition, one can take $A_P = A_P(k_\infty)^0$, $A_P(k_\infty)$, or $[A_P]$. The last one this seems the most natural choice, in general, but, when $k = \mathbb Q$, and we take $A_P = A_P(k_\infty)^0$ (or, more generally, when $k$ is a number field, and we replace $k_\infty$ by the diagonal embedding of $\mathbb R$ in $k_\infty$), we obtain the \emph{reductive Borel--Serre compactification}, which is a manifold with corners (after we mod out by a sufficiently small compact open subgroup of $G(\mathbb A_f)$) --- this is why we use the notation ${[G]}^{RBS}$ in general. Thus, we will be using $A_P$, and leave it to the reader to choose their favorite version, except where we need to use a specific one.


We will define, more generally, an embedding $[G]^F$ for every fan $F$ of rational, strictly convex polyhedral cones supported in $\mathfrak a^+$, following \cite{Sakellaridis-stacks}. Set-theoretically, it will be the union of $G(\mathbb A)$-orbits $Z_C$, for all cones $C\in F$. The RBS compactification will be the one corresponding to $F=$ the fan consisting of the faces of $\mathfrak a^+_{ss}$. 

Assume, first, that $F$ is a fan supported entirely on the face of the anti-dominant cone corresponding to a parabolic $P$ with Levi quotient $L$, whose split center $A_P$ is canonically a subtorus of $A$. Then $F$ defines a toric embedding $A_P\hookrightarrow \overline{A_P}^F$, and we set:
\begin{equation}
\label{equation-LF} 
[L]^{F}:= \overline{A_P}^F\times^{A_P} [L],
\end{equation}
\begin{equation}
\label{equation-GF} 
[G]_P^{F}:= [L]^{F} \times^{P(\mathbb A)} G(\mathbb A).
\end{equation}
Its $G(\mathbb A)$-orbits are in natural bijection with cones in the fan, as is the case with $A_P$-orbits in $\overline{A_P}^F$. If $C\in F$ does not belong to the face corresponding to any larger parabolic,  we let $Z_C$ be the orbit corresponding to a cone $C$. If $C$ belongs to the face corresponding to a larger parabolic $Q$, we will denote its orbit by $Z_C^P$, because $Z_C$ will be defined by the analogous construction for $Q$.

For a general fan $F$, the $G(\mathbb A)$-space $[G]_P^{F}$ will be defined by the formula \eqref{equation-GF}, once $[L]^{F}$ is defined. To define $[L]^F$, we may assume that $L=G$, and that the spaces $[L]^{F}$, $[G]_P^{F}$ have been defined for all proper parabolics $P$.

We first consider the restriction $F_G$ of $F$ to $\mathfrak a_G$ (i.e.\ the sub-fan consisting of all cones which are contained in the central cocharacter space of $G$). By \eqref{equation-LF}, it defines an embedding $[G]^{F_G}$ of $[G]$. Now, all the strata $Z_C$ have been defined: If $C$ belongs to $\mathfrak a_G$, then $Z_C\subset [G]^{F_G}$. If not, then $Z_C$ has been defined is a stratum of $[G]_P^F$, for $P=$ the maximal parabolic such that $C\subset \mathfrak a_P$, and, by the inductive construction, it is a stratum of $[G]_Q^F$, for all $Q\supset P$ other than $G$. There remains to explain how to glue those onto $[G]^{F_G}$. 

It suffices to consider a maximal parabolic $P$. 
First, we lift the embedding $[G]_P^{F}$ to an embedding of the space $\overline{A_G}^{F_G} \times^{A_G} P(k)\backslash G(\mathbb A)$ (recall that $F_G$ is the restriction of $F$ to $\mathfrak a_G$), by considering the universal $G(\mathbb A)$-space $X$ fitting in a diagram of continuous, $G(\mathbb A)$-equivariant maps:
$$ \xymatrix{\overline{A_G}^{F_G} \times^{A_G} P(k)\backslash G(\mathbb A) \ar[d] \ar[r] & X \ar[d] \\ \overline{A_G}^{F_G} \times^{A_G} [G]_P \ar[r] & [G]_P^F},$$
where the first horizontal map is supposed to be an isomorphism over $\overline{A_G}^{F_G} \times^{A_G} [G]_P$.
Explicity, the universal such $X$ (to be denoted $\overline{P(k)\backslash G(\mathbb A)}^F$) is the union of $\overline{A_G}^{F_G} \times^{A_G} P(k)\backslash G(\mathbb A)$ with all $G(\mathbb A)$-orbits $Z_C\subset [G]_P^F$ with $C\in F$ not belonging to $\mathfrak a_G$. (We stress again that, for $C\subset \mathfrak a_G$, the corresponding orbit $Z_C^P\subset [G]_P^F$ is different from the orbit $Z_C \subset [G]^{F_G}$, which will be part of the final compactification $[G]^F$.)

Now, consider the pair of quotient maps \eqref{equation-leftright}. By Theorem \ref{theorem-reduction-theory-split}, there is an $[A_G]$-stable neighborhood of the $P$-cusp where the map $\pi_G$ is an isomorphism. Thus, we can glue $\overline{P(k)\backslash G(\mathbb A)}^F$ to $[G]$ over such a neighborhood. In fact, the map $\pi_G$ extends to a morphism 
$$ \overline{A_G}^{F_G} \times^{A_G} P(k)\backslash G(\mathbb A) \to [G]^{F_G},$$
which is an isomorphism on an $[A_G]$-invariant neighborhood of the $P$-cusp. All orbits $Z_C\subset \overline{P(k)\backslash G(\mathbb A)}^F$ with $C$ not belonging to $\mathfrak a_G$ have a neighborhood which is contained in such a neighborhood of the $P$-cusp, \emph{therefore we can use such a neighborhood to glue $Z_C$ to $[G]^{F_G}$}. 

Finally, if $Z_C\subset [G]_P^F$ and $Z_C\subset [G]_Q^F$ for two different maximal parabolics, there is a smaller parabolic $R\subset P\cap Q$ such that $Z_C\subset [G]_R^F$, and a neighborhood of $Z_C$ in $[G]_R^F$ is contained in a neighborhood of the $R$-cusp whose preimage in $R(k)\backslash G(\mathbb A)$ injects into both $P(k)\backslash G(\mathbb A)$ and $Q(k)\backslash G(\mathbb A)$, and into $[G]$. Thus, the way that $Z_C$ is glued to $[G]$ does not depend on the choice of maximal parabolic $P$ or $Q$.

\begin{definition}
 \label{definition-equivariant-toroidal-compactification}
The (partial) compactification $[G]^F$ described above, where $F$ is a fan supported on $\mathfrak a^+$, will be called the {\it equivariant toroidal compactification} attached to $F$. If $F=\mathfrak a^+_{ss}$, it will be denoted by $[G]^{RBS}$, for {\it reductive Borel--Serre compactification}. (It is a partial compactification if $\mathfrak a_G$ is nontrivial.)
\end{definition}

\begin{remark}
 \label{remark-toroidal-name}
The equivariant toroidal compactifications are not related to the ``toroidal compactifications'' of locally symmetric spaces, defined by Ash--Mumford--Rapoport--Tai in \cite{Ash-Mumford-Rapoport-Tai}. However, the name is appropriate as they are have the local structure of toric varieties. 
\end{remark}






\section{Reduction theory in the general case}
\label{section-reduction-theory-general}

We will now use the split case to deduce the general theorem of reduction theory. The main tool will be the compactification $[G]^{RBS}$ of Definition \ref{definition-equivariant-toroidal-compactification}, and the fact that ``it is defined over $k$'', in the following sense:

\begin{proposition}
 \label{proposition-RBS-Galois-stable}
 Let $G$ be a connected reductive group over $k$, and let $k\hookrightarrow l$ be a Galois extension, with Galois group $\Gamma$, such that $G$ splits over $l$. Then, the action of $\Gamma$ on $[G_l]$ extends continuously to the RBS compactification $[G_l]^{RBS}$.
\end{proposition}

\begin{proof}
 The basic ingredient of the proof is that \emph{the boundary degeneration $[G]_B$ is ``defined'' over $k$}, in the sense that $[G_l]_B$ admits a canonical action of $\Gamma$. The reason is that the flag variety $\mathcal B$ of $G$ is defined over $k$, even if $G$ has no Borel subgroups over $k$. Recall that $B(l)\backslash G(\mathbb A_l) = \mathcal B(l)\times^{G(l)}G(\mathbb A_l)$, so it has a natural action of $\Gamma$. This action descends to $[G_l]_B$ (= the quotient of $\mathcal B(l)\times^{G(l)}G(\mathbb A_l)$ by the group bundle of unipotent radicals over $\mathcal B(\mathbb A_l)$).
 
 The same holds for the partial flag varieties of the form $P\backslash G$, except that one has to group them into \emph{associate classes}: Two conjugacy classes of parabolics are called \emph{associate} if they have conjugate Levi subgroups. An associate class $\mathcal A$ of parabolics is a variety defined over $k$, such that $\mathcal A_l$ splits into a disjoint union of conjugacy classes $\mathcal P_i$ of parabolics. Thus, we have a well-defined action of $\Gamma$ on $\sqcup_i \mathcal P_i(l)$, and from this we obtain a well-defined action of $\Gamma$ on the union $\sqcup_i P_i(l)\backslash G(l)$, or the union of boundary degenerations $\sqcup_i [G_l]_{P_i}$. 
 
 Using these facts, it is not hard to see that the $\Gamma$-action extends to $[G_l]^{RBS}$; we leave the details to the reader.
\end{proof}


If, now, $G$ is a reductive group over $k$, and $k\hookrightarrow l$ is a Galois extension, with Galois group $\Gamma$, such that $G$ splits over $l$, we have an embedding $[G_k]\hookrightarrow [G_l]^\Gamma\hookrightarrow ([G_l]^{RBS})^\Gamma$.

\begin{proposition}
 \label{proposition-Gk-in-Gl}
If $\mathcal P$ is a conjugacy class of parabolics in $G_l$, and $[G_k]$ has an accumulation point in the $\mathcal P$-cusp of $[G_l]^{RBS}$, then $\mathcal P$ has an element $P$ defined over $k$. Moreover, there is a neighborhood $V$ of the $P$-cusp of $[G_l]^{RBS}$ such that $\pi_G(\tilde V) \cap [G_k] = \pi_G(\tilde V \cap P(k)\backslash G(\mathbb A))$, where $\pi_G$ is the map of \eqref{equation-leftright}. 
\end{proposition}

\begin{proof}
The statement is local over the $P$-cusp, so it is enough to replace ``neighborhood of the cusp'' by ``neighborhood of a compact subset of the cusp''. Let $V$ to be any $\Gamma$-stable neighborhood in $[G_l]_P$ of a compact subset of accumulation points of $[G_k]$ in the $P$-cusp, satisfying the conclusion of the injectivity statement (I) of Theorem \ref{theorem-reduction-theory-split}. If $[g]\in [G_k]$ is a point in $\pi_G(\tilde V)$ by the injectivity property, and the stability of $V$, $g$ under $\Gamma$, the preimage $\tilde g$ of $g$ in $\tilde V$ is also $\Gamma$-stable. But 
$$\tilde g \in P(l)g \in \mathcal P(l)\times^{G(k)}G(\mathbb A_k)\subset \mathcal P(l)\times^{G(l)}G(\mathbb A_l) = P(l)\backslash G(\mathbb A_l),$$
hence the Galois action on the subset $\mathcal P(l)\times^{G(k)}G(\mathbb A_k)$ mapping to $[G_k]$ comes entirely from its action on $\mathcal P(l)$ (more precisely, on $\mathcal A(l)$, where $\mathcal A$ is the union of associate classes to $\mathcal P$). Thus, the existence of a $\Gamma$-fixed point on $P(l)\backslash G(\mathbb A_l)$, mapping to $[G_k]$, implies that $\mathcal P(k) \ne \emptyset$, and $g\in [G_k]_P$.
\end{proof}




\begin{theorem}
 \label{theorem-reduction-theory-general}
Let $G$ be a reductive connected group over $k$, and $P\subset G$ a (class of) parabolic(s).
 \begin{description}
  \item[(C)] $[G]$ is compact iff $G$ is anisotropic (i.e., does not contain any split torus). 
  \item[(I)] Every compact subset of the $P$-cusp in $\overline{[G]_P}$ has a neighborhood $V$ such that $\pi_G|_{\tilde V}$ is injective, where $\tilde V$ is the preimage of $V$ in $P(k)\backslash G(\mathbb A)$.
  \item[(S)] Every $[A_G]$-invariant neighborhood of the degenerate $P$-cusp in $[G]_P$ (where $A_G$ is the maximal split torus in the center of $G$) can be scaled to a neighborhood $V$ such that $\pi_G|_{\tilde V}$ is surjective, where $\tilde V$ is as above. 
 \end{description}
\end{theorem}


\begin{proof}
Again, having addressed the case of tori in Proposition \ref{proposition-automorphic-tori}, we will now assume that $G$ is semisimple; the combination of the two to address the general case is left to the reader. 


We start with (C):  Let $k\hookrightarrow l$ be a Galois extension, with Galois group $\Gamma$, such that $G$ splits over $l$. Then, we have a closed embedding $[G_k]\hookrightarrow [G_l]^\Gamma$. If $[G_k]$ is not compact, then it has a $\Gamma$-stable accumulation point in some boundary component (some $P$-cusp) of $[G_l]^{RBS}$. By Proposition \ref{proposition-Gk-in-Gl}, it must have a proper parabolic, which contradicts the assumption that $G$ is anisotropic over $k$.

For (I), there is nothing to prove, since by embedding again $[G_k]\hookrightarrow [G_l]$, the statement follows from the corresponding statement for split groups, contained in Theorem \ref{theorem-reduction-theory-split}.

 
Now we pass to (S). The same argument as in the split case reduces us to the case of split semisimple rank one. Thus, we assume that $G$ has a unique class of proper parabolics $P$ over $k$.  Since $P$ is minimal, by the statement (C) applied to its Levi quotient $L$, its cusp will be compact, and therefore the neighborhoods of the $P$-cusp coincide with the neighborhoods of the degenerate $P$-cusp. If, again, $l$ is a splitting field as above, and $V$ is any small neighborhood of the $P$-cusp in $[G_l]_P$ satisfying the conclusion of Proposition \ref{proposition-Gk-in-Gl}, the proposition shows that, on one hand, $[G_k]\smallsetminus \pi_G(\tilde V)$ is relatively compact, and on the other $P(k)\backslash G(\mathbb A)\cap \tilde V$ surjects onto $[G_k]\cap  \pi_G(\tilde V)$. Thus, there is an $A_P(\mathbb A)$-scaling $V'$ of $V\cap [G_k]_P$ such that $\pi_G(\tilde V') = [G_k]$. 
\end{proof}

Now we draw some corollaries from Theorem \ref{theorem-reduction-theory-general}: the finiteness of class numbers, and a more classical formulation, saying that $[G]$ can be covered by domains of a particular form, called \emph{Siegel sets}.

\begin{definition}
 \label{definition-fundamental-set-domain}
A {\it fundamental domain} for the action of a discrete subgroup $\Gamma$ on a locally compact group $G$ is an open subset $D$ of $G$ such that no two points of $D$ are in the same $\Gamma$-orbit, and such that $G= \cup{\gamma\in \Gamma} \gamma \bar D$. 

A {\it fundamental set} $\Omega$ for $\Gamma\backslash G$ is a subset of $G$ such that $\Gamma\cdot \Omega= G$ and the set $\{\gamma\in \Gamma | \gamma \Omega \cap \Omega \neq \emptyset\}$ is finite. 
\end{definition}


\begin{definition}
 \label{definition-Siegel-set}
Let $P\subset G$ be a minimal parabolic subgroup, and fix a maximal compact subgroup $K\subset G(\mathbb A)$ satisfying the Iwasawa decomposition $G(\mathbb A)= P(\mathbb A) K$. A {\it Siegel set} is a subset of $G(\mathbb A)$ of the form: $\Omega A_\epsilon K$, where: 
\begin{itemize}
 \item $\Omega$ is a compact subset of $P(\mathbb A)$;
 \item $A_\epsilon\subset A_P(k_\infty)$ (or, in the number field case, $A_\epsilon\subset A_P(\mathbb R)^0$, where $\mathbb R\hookrightarrow k_\infty$ is the diagonal embedding) is the subset of those elements $t$ satisfying $|e^\alpha(t)|>\epsilon>0$ for all positive roots $\alpha$. \footnote{More generally, one can specify different values of $\epsilon$ for different roots.}
\end{itemize} 
\end{definition}

Then, a corollary of Theorem \ref{theorem-reduction-theory-general} is:

\begin{theorem}
\label{theorem-Siegel-finiteness}
\begin{enumerate}
 \item For every compact open subgroup $J\subset G(\mathbb A_f)$, the number of $G(k_\infty)$-orbits on $[G]/J$ is finite.
 \item There exists a Siegel set which is a fundamental set for $[G]$.
\end{enumerate}
\end{theorem}

\begin{proof}
Let $P\subset G$ be a minimal parabolic, and $K\subset G(\mathbb A)$ a maximal compact subgroup satisfying the Iwasawa decomposition $G(\mathbb A) = P(\mathbb A)K$. Using the Iwasawa decomposition, the question is reduced to the question of $P(k_\infty)$-orbits on $[P]/J_P$, where $J_P$ is an open compact subgroup of $P(\mathbb A_f)$. If $P\to L\to L^{ab}$ are the Levi quotient of $P$ and its abelianization, a torus, the problem is easily reduced from $P$ to $L$ by means of Proposition \ref{proposition-automorphic-Ga}, from $L$ to $L^{ab}$ by means of the compactness of $[L']$, where $L'$ is the derived subgroup of $L$ (Statement (C) of Theorem \ref{theorem-reduction-theory-general}), and the case of $L^{ab}$ is Proposition \ref{proposition-automorphic-tori}.

For the second statement, first choose a compact subset $\Omega\subset P_0(\mathbb A)$, such that $U(k)\Omega \supset U(\mathbb A)\Omega$ (possible by Proposition \ref{proposition-automorphic-Ga}), and $U(\mathbb A) A_P(k_\infty) \Omega = G(\mathbb A)$ (or, respectively, $U(\mathbb A) A_P(\mathbb R) \Omega = G(\mathbb A)$ --- this is possible by the compactness of $[L']$, and the finiteness of the class number for tori, Proposition \ref{proposition-automorphic-tori}, applied to $L^{ab}$.

The surjectivity, now, of a subset of the form $\Omega A_\epsilon K$ onto $[G]$ follows from Statement (S) of Theorem \ref{theorem-reduction-theory-general}.
\end{proof}



\section{Weak and strong approximation.}
\label{section-approximation}


\begin{definition}
 \label{definition-weak-approximation}
We say that a (geometrically integral) variety $X$ over $k$ satisfies {\it weak approximation} if:
\begin{quote}
 For every finite set of places $S$,  $X(k)$ is dense in $X_S=\prod_{v\in S} X(k_v)$.
\end{quote}
Equivalently, if:
\begin{quote}
 $X(k)$ is dense in $\prod_v X(k_v)$
\end{quote}
the product taken over all places. 

We say that $X$ has the property of weak approximation away from a finite set of places $\Sigma$ if this property holds with the product taken over all places outside of $\Sigma$. For instance, if $\Sigma=\infty$ and an integral model (i.e.\ the structure of an $\mathfrak o$-scheme, where $\mathfrak o$ is the ring of integers in $k$) is given, then weak approximation outside of $\Sigma$ means that for every finite set of finite places $S$, every integer $N$ and every set of points $(x_v \in X(k_v))_{v\in S}$ we can find $x\in X(k)$ such that $x\equiv x_v \mod \mathfrak p_v^N$.
\end{definition}

We have:
\begin{theorem}[Kneser, Platonov]
\label{theorem-weak-approximation}
 Let $G$ be semisimple simply connected or adjoint. Then $G$ satisfies weak approximation.
\end{theorem}

\begin{proof}
 See \cite[Theorem 7.8]{Platonov-Rapinchuk}.
\end{proof}

There are many more examples of groups which satisfy weak approximation, for instance $\text{GL}_n$. (Proof: $\text{GL}_{n,S}$ is open in $\text{Mat}_{n,S}$ and carries the induced topology, so since $\text{Mat}_n$ satisfies weak approximation, so does $\text{GL}_n$.) In fact, any split reductive group, being a rational variety (by the Bruhat decomposition), satisfies weak approximation. However, weak approximation can fail already for tori:

\begin{example}
 \label{example-failure-weak-approximation}
Let $L = \mathbb Q(\sqrt{-1},\sqrt{2})$, and let $T$ be the kernel of the norm map $L^\times \to \mathbb Q^\times$, considered as an algebraic torus over $\mathbb Q$. Then, the closure of $T(\mathbb Q)$ has index $2$ in $T(\mathbb Q_2)$; see \cite[p.423]{Platonov-Rapinchuk}.
\end{example}


\begin{definition}
 \label{definition-strong-approximation}
We say that a variety $X$ satisfies {\it strong approximation} away from a finite set of places $\Sigma$ if:
\begin{quote}
 $X(k)$ is dense in $X^\Sigma=X(\mathbb A^\Sigma)$. 
\end{quote}
Sometimes if $\Sigma=\infty$ we say that $X$ satisfies strong approximation without mentioning $\Sigma$. Hence, strong approximation (away from $\infty$) is a strengthening of the statement ``class number = 1''. Notice that the above condition is much stronger than being dense in $\prod_v(k_v)$, because the topology on the adeles is finer than the induced topology from $\prod_v(k_v)$. For instance, if $G=\text{GL}_n$ and $\Sigma=\infty$ then the property reads: For every set $S$ of finite places and for all $(x_v\in k_v)_{v\in S}$ \emph{there exist $S$-integers} in $k^\times$ (i.e.\ elements of $k^\times\cap \prod_{v\in S\cup\infty} k_v^\times \prod_{v\notin S\cup\infty} \mathfrak o_v^\times$) which approximate $(x_v)_{v\in S}$. 
 
\end{definition}



A slightly weaker version of the following theorem was proven by Kneser:
\begin{theorem}[Platonov, Prasad]
\label{theorem-strong-approximation}
 Let $G$ be an algebraic group over a global field $k$, and let $\Sigma$ be a finite set of places. Then, $G$ satisfies strong approximation outside of $\Sigma$ if and only if $G$ is connected and simply connected (in particular, semisimple), and there is no simple component $G_1\subset G$ over $k$ such that $G_1(k_\Sigma)$ is compact.
\end{theorem}

\begin{proof}
 See \cite[\S 7.4]{Platonov-Rapinchuk} for number fields. (Prasad proved the function field case.) Let us only outline an elementary proof in the case of $\text{SL}_n$, for any nonempty set of places $\Sigma$: In this case, for any place $v$, the group $\text{SL}_n(k_v)$ is generated by the elementary subgroups $I+ k_v E_{ij}$ (where $E_{ij}$ is the matrix with $1$ in the $(i,j)$-th entry, and zero otherwise), and by the case of the additive group, Proposition \ref{proposition-automorphic-Ga}, $I+kE_{ij}$ is dense in $I+ \mathbb A^\Sigma E_{ij}$. Therefore, $\text{SL}_n(k)$ is dense in $\text{SL}_n(\mathbb A^\Sigma)$. 
\end{proof}


Notice that this statement implies, in particular, that $\text{SL}_n(\mathbb Z)$ is dense in $\text{SL}_n(\widehat{\mathbb Z})$, i.e.\ the map: $\text{SL}_n(\mathbb Z)\to \text{SL}_n(\mathbb Z/n)$ is surjective for every $n$. Such a result is certainly not true for the multiplicative group, for instance: $\mathbb Z^\times$ does not surject onto $(\mathbb Z/5)^\times$.

\begin{example}
 \label{example-failure-strong-approximation}
Here is an example for the failure of strong approximation: Assume that $G$ is a linear algebraic group, and $\Sigma$ is a finite, nonempty set of places such that $G(k_\Sigma)$ is compact. Since $G(k)$ is discrete in $G(\mathbb A) = G(\mathbb A^\Sigma) \times G(k_\Sigma)$, and $G(k_\Sigma)$ is compact, it follows that $G(k)$ is discrete in  $G(\mathbb A^\Sigma)$, and therefore it is not dense.
\end{example}


\section{The class number of a reductive group}
\label{section-class-number}

\begin{definition}
 \label{definition-class-number}
 Let $G$ be a linear algebraic group over the ring of integers $\mathfrak o$ of a number field $k$, or over the integers of a function field away from a non-empty set of places that we will denote as $k_\infty$. The cardinality of the set $G(k)\backslash G(\mathbb A_f)/\prod_{v\ne \infty} G(\mathfrak o_v)$ is the {\it class number} of $G$. 
\end{definition}

The class number is always finite, by Theorem \ref{theorem-Siegel-finiteness}. Here, we will use strong approximation (definitely a deeper fact than reduction theory) in order to get a more precise calculation of the class number in several cases.

\begin{proposition}
\label{proposition-class-number-abelianization}
Assume that the derived group $G'$ of $G$ is simply connected, and does not contain any factor $G_1'$ over $k$ with $G_1'(k_\infty)$ compact. Let $G^{ab}$ be the abelianization of $G$, $K\subset G(\mathbb A_f)$ a compact open subgroup, and $K^{ab}$ the image of $K$ in $G^{ab}$. 

Then, the double quotients $G(k)\backslash G(\mathbb A_f)/K$ and $G^{ab}(k)\backslash G^{ab}(\mathbb A_f)/K^{ab}$ are in bijection, under the natural map $G(\mathbb A_f)\to G^{ab}(\mathbb A_f)$.

In particular, the class numbers of $G$ and $G^{ab}$ coincide.
\end{proposition}

\begin{proof}
 By Theorem \ref{galoiscohomology-theorem-H1-trivial}, the Galois cohomology $H^1(k_v, G')$ is trivial for any finite place $v$, therefore the map $G(\mathbb A)\to G^{ab}(\mathbb A)$ is surjective. 
 
 Similarly, by Theorem \ref{galoiscohomology-theorem-Hasse-principle}, the Galois cohomology $H^1(k, G')$ injects into $H^1(k_\infty, G) := \prod_{v|\infty} H^1(k_v, G)$ (actually, surjects, by Proposition \ref{galoiscohomology-proposition-H1-surjects}, but we won't use that).
 
 Hence, we have exact sequences $G(k)\to G^{ab}(k) \to H^1(k_\infty, G')$ and $G(\mathbb A)\to G^{ab}(\mathbb A) \to H^1(k_\infty,G')$, compatible with the embeddings $G(k)\to G(\mathbb A)$ and $G^{ab}(k)\to G^{ab}(\mathbb A)$, and, in particular, since $G^{ab}(\mathbb A_f)$ lies in the kernel of the map to $H^1(k_\infty, G')$, the images of $G(k)$ and $G^{ab}(k)$ in $G^{ab}(\mathbb A_f)$ are equal. 
 
 Thus, the fiber [...]
 
 Therefore, the quotients $G(k)\backslash G(\mathbb A_f)/K$ and $G^{ab}(k)\backslash G^{ab}(\mathbb A_f)/K^{ab}$ are in bijection.
\end{proof}

Notice that this gives a group structure to the double quotient $G(k)\backslash G(\mathbb A_f)/K$ and, in particular, we can talk about the class group of $G$. More generally, 

\begin{proposition}
 \label{proposition-class-group}
 \cite[Proposition 8.8]{Platonov-Rapinchuk}
\end{proposition}

\begin{proof}
 
\end{proof}


\begin{definition}
 \label{definition-class-group}
If $G$ satisfies the conditions of Proposition \ref{proposition-class-group}, the double quotient $G(k)\backslash G(\mathbb A_f)/\prod_{v\ne \infty} G(\mathfrak o_v)$, with the group structure inherited from this proposition, is the {\it class group} of $G$. 
\end{definition}

For more general reductive groups, we can analyze their class number/group with the help of \emph{$z$-extensions}:

\begin{definition}
 \label{definition-z-extention}
A {\it $z$-extension} of a reductive group $G$ is a short exact sequence of algebraic (necessarily reductive) groups
$$ 1\to T\to \tilde G\to G\to 1,$$
where $T$ is an induced torus (Definition \ref{algebraicgroups-definition-induced-torus}), and the derived group of $G'$ is simply connected.
\end{definition}

\begin{proposition}
 \label{proposition-z-extension-exists}
Any reductive group over a field $k$ admits a $z$-extension.
\end{proposition}


\begin{proof}
\end{proof}

[To be continued: describe the class group of $G$ in terms of the class group of $\tilde G^{ab}$, where $\tilde G$ is a $z$-extension.]

\section{Tamagawa numbers}
\label{section-Tamagawa-numbers}



\input{chapters}


\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}


